<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Infinity_Craft - Ù…ÙˆØ¯Ø§Øª</title>
  <style>
    body{font-family:Tahoma,Arial;background:#fff;margin:0;padding:0;color:#222}
    header{background:#c62828;color:#fff;padding:14px 16px;text-align:center;font-size:22px}
    .container{max-width:760px;margin:18px auto;padding:0 12px}
    .top-row{display:flex;gap:12px;align-items:center;justify-content:center;margin-bottom:12px}
    .btn{padding:10px 18px;border-radius:8px;border:0;cursor:pointer}
    .btn.green{background:#2e7d32;color:#fff}
    .btn.red{background:#d32f2f;color:#fff}
    .search{width:100%;padding:12px;border:3px solid #32a852;border-radius:10px;margin:6px 0;font-size:16px}
    .card{border:2px solid #e0e0e0;border-radius:14px;padding:18px;margin:14px 0;background:#fafafa}
    form .input{width:100%;padding:12px;border-radius:8px;border:1px solid #ccc;margin:8px 0;font-size:15px}
    .mods-grid{display:block}
    .mod-item{border:3px solid #c8e6c9;border-radius:12px;padding:14px;margin:12px 0;background:#fff}
    .mod-item img{max-width:100%;height:auto;border-radius:8px;margin-top:8px}
    .small{font-size:14px;color:#666}
    .actions{margin-top:10px}
    .delete-btn{background:#d32f2f;color:#fff;border-radius:8px;padding:8px 12px;border:0}
    .download-btn{background:#2e7d32;color:#fff;border-radius:8px;padding:8px 12px;border:0}
    footer{margin:30px 0;text-align:center;color:#777}
    .brand{font-weight:bold}
  </style>
</head>
<body>

<header>Infinity Craft ğŸŒ</header>
<div class="container">

  <div style="text-align:center;margin-bottom:8px">
    Ø§Ù„Ù…Ø·ÙˆØ±: <span class="brand">Asernoby23</span> &nbsp; Ø§Ù„Ù…Ø§Ù„Ùƒ: <span class="brand">kraivx09</span>
  </div>

  <!-- top: Telegram link + (we will hide publish in app if you want) -->
  <div class="top-row">
    <a href="https://t.me/+qq_iB3QRLpJjMGFk" target="_blank" class="btn" style="background:transparent;color:#c62828;border:2px solid #c62828;border-radius:8px">Ù‚Ù†Ø§Ø© Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…</a>
    <!-- Ø²Ø±Ø§Ø± Ø§Ù„Ù†Ø´Ø± ÙÙŠ Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Ù„Ùˆ Ø¹Ø§ÙŠØ² ØªØ´ÙŠÙ„Ù‡ Ù…Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø³ Ø§ØªØ±ÙƒÙ‡ Ù‡Ù†Ø§) -->
    <button id="showPublish" class="btn green">Ø§Ù†Ø´Ø± Ù…ÙˆØ¯Ùƒ â¬†ï¸</button>
  </div>

  <!-- search -->
  <input id="searchInput" class="search" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ÙˆØ¯..." />

  <!-- Publish form (Ù…Ø®ÙÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹) -->
  <div id="publishCard" class="card" style="display:none">
    <h3 style="margin:0 0 8px 0;text-align:center">Ù†Ø´Ø± Ù…ÙˆØ¯ Ø¬Ø¯ÙŠØ¯</h3>
    <input id="authorName" class="input" placeholder="Ø§Ø³Ù…Ùƒ (Ù‡ÙŠØ¸Ù‡Ø± ÙƒØµØ§Ø­Ø¨ Ø§Ù„Ù…ÙˆØ¯)" value="" />
    <input id="modName" class="input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¯" />
    <textarea id="modDesc" class="input" placeholder="ÙˆØµÙ Ø§Ù„Ù…ÙˆØ¯" rows="3"></textarea>
    <input id="downloadLink" class="input" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ­Ù…ÙŠÙ„ (direct link)" />
    <input id="imageUrl" class="input" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø± (direct image link)" />
    <div style="text-align:center">
      <button id="publishBtn" class="btn green">ğŸš€ Ù†Ø´Ø± Ø§Ù„Ù…ÙˆØ¯</button>
      <button id="hidePublish" class="btn" style="background:#eee;margin-right:8px">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
    <div id="publishMsg" style="margin-top:8px;color:#d32f2f"></div>
  </div>

  <h2 style="text-align:center;margin-top:12px">ÙƒÙ„ Ø§Ù„Ù…ÙˆØ¯Ø§Øª ğŸ§©</h2>

  <div id="modsList" class="mods-grid">
    <!-- populated by JS -->
  </div>

  <footer>
    ØªØ§Ø¨Ø¹Ù†Ø§ Ø¹Ù„Ù‰ ØªÙ„ÙŠØ¬Ø±Ø§Ù…: <a href="https://t.me/+qq_iB3QRLpJjMGFk" target="_blank">Infinity Craft</a>
  </footer>
</div>

<!-- Firebase v9 modular (from CDN) -->
<script type="module">
  // Firebase libs
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
  // your config (you gave this earlier)
  const firebaseConfig = {
    apiKey: "AIzaSyAtn8wwDmlWe95RA13kAQiY0XDkhnuKoQ0",
    authDomain: "infinity-craft-301e4.firebaseapp.com",
    databaseURL: "https://infinity-craft-301e4-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "infinity-craft-301e4",
    storageBucket: "infinity-craft-301e4.firebasestorage.app",
    messagingSenderId: "979672021905",
    appId: "1:979672021905:web:849ecc0ed6379edb2eb830",
    measurementId: "G-G188MXB3JY"
  };
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // UI elements
  const showPublish = document.getElementById('showPublish');
  const publishCard = document.getElementById('publishCard');
  const hidePublish = document.getElementById('hidePublish');
  const publishBtn = document.getElementById('publishBtn');
  const publishMsg = document.getElementById('publishMsg');
  const modsList = document.getElementById('modsList');
  const searchInput = document.getElementById('searchInput');

  // Fields
  const authorName = document.getElementById('authorName');
  const modName = document.getElementById('modName');
  const modDesc = document.getElementById('modDesc');
  const downloadLink = document.getElementById('downloadLink');
  const imageUrl = document.getElementById('imageUrl');

  // show/hide
  showPublish.addEventListener('click', ()=> { publishCard.style.display='block'; publishMsg.textContent=''; });
  hidePublish.addEventListener('click', ()=> { publishCard.style.display='none'; });

  // publish function
  publishBtn.addEventListener('click', async ()=>{
    publishMsg.textContent='';
    const author = (authorName.value || 'Ù…Ø¬Ù‡ÙˆÙ„').trim();
    const name = modName.value.trim();
    const desc = modDesc.value.trim();
    const dl = downloadLink.value.trim();
    const img = imageUrl.value.trim();

    if(!name || !dl){ publishMsg.textContent='Ù…Ø·Ù„ÙˆØ¨: Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¯ ÙˆØ±Ø§Ø¨Ø· Ø§Ù„ØªØ­Ù…ÙŠÙ„.'; return; }
    try{
      await addDoc(collection(db,'mods'), {
        name, description: desc, downloadLink: dl, imageUrl: img,
        author, createdAt: new Date().toISOString()
      });
      // success
      modName.value=''; modDesc.value=''; downloadLink.value=''; imageUrl.value='';
      publishMsg.style.color='green';
      publishMsg.textContent='ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¨Ù†Ø¬Ø§Ø­ âœ…';
      // keep form open if user wants to publish more
    } catch(e){
      publishMsg.style.color='red';
      publishMsg.textContent='Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø´Ø±: '+e.message;
    }
  });

  // realtime listener: show all mods (ordered by createdAt desc)
  const q = query(collection(db,'mods'), orderBy('createdAt','desc'));
  onSnapshot(q, (snapshot)=>{
    const docs = [];
    snapshot.forEach(d => docs.push({id:d.id, ...d.data()}));
    renderMods(docs);
  });

  // render with search and delete-per-owner (simple client-side owner check)
  function renderMods(list){
    const term = (searchInput.value || '').trim().toLowerCase();
    modsList.innerHTML = '';
    const viewerName = localStorage.getItem('viewerName') || ''; // current "you" name for delete check
    list.filter(mod => {
      if(!term) return true;
      return (mod.name||'').toLowerCase().includes(term) || (mod.description||'').toLowerCase().includes(term) || (mod.author||'').toLowerCase().includes(term);
    }).forEach(mod => {
      const el = document.createElement('div');
      el.className = 'mod-item';
      el.innerHTML = `
        <h3 style="margin:0">${escapeHtml(mod.name||'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…')}</h3>
        <div class="small">Ø¨ÙˆØ§Ø³Ø·Ø©: ${escapeHtml(mod.author||'Ù…Ø¬Ù‡ÙˆÙ„')}</div>
        ${mod.imageUrl ? `<img src="${escapeHtml(mod.imageUrl)}" alt="${escapeHtml(mod.name)}" onerror="this.style.display='none'">` : ''}
        <p style="margin:8px 0">${escapeHtml(mod.description||'')}</p>
        <div class="actions">
          <a class="download-btn" href="${escapeHtml(mod.downloadLink||'#')}" target="_blank">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¯ â¬‡ï¸</a>
          ${ (viewerName && viewerName === (mod.author||'')) ? ` <button class="delete-btn" data-id="${mod.id}">Ø­Ø°Ù</button>` : '' }
        </div>
      `;
      modsList.appendChild(el);
    });

    // attach delete handlers
    document.querySelectorAll('.delete-btn').forEach(btn => {
      btn.onclick = async () => {
        const id = btn.getAttribute('data-id');
        if(!confirm('Ù…ØªØ£ÙƒØ¯ ØªØ­Ø°Ù Ø§Ù„Ù…ÙˆØ¯ Ø¯Ù‡ØŸ')) return;
        try{
          await deleteDoc(doc(db,'mods',id));
          alert('ØªÙ… Ø§Ù„Ø­Ø°Ù');
        } catch(e){
          alert('Ø®Ø·Ø£: '+e.message);
        }
      };
    });
  }

  // simple search realtime
  searchInput.addEventListener('input', ()=>{ /* onSnapshot will re-render if list changes */});

  // helper: basic escaping
  function escapeHtml(s){ if(!s) return ''; return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

  // store viewer name so delete button shows only if viewer uses same name
  authorName.addEventListener('change', ()=>{ localStorage.setItem('viewerName', authorName.value.trim()); });
  // initialize viewerName from localStorage if exists
  if(localStorage.getItem('viewerName')) authorName.value = localStorage.getItem('viewerName');

  // optional: hide publishBtn on mobile app version â€” you said app should not show publish button.
  // If you want site-only publish and app to hide, add logic on app side to remove element or set CSS.
</script>

</body>
</html>
