Ø¯<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Infinity_Craft - Ù…ÙˆØ¯Ø§Øª</title>
<style>
  :root{--red:#D32F2F;--green:#4CAF50;--muted:#666;}
  body{margin:0;font-family: "Cairo", sans-serif;background:#fff;color:#111;direction:rtl}
  header{background:var(--red);color:#fff;padding:14px 12px;text-align:center;font-weight:800}
  .container{max-width:980px;margin:14px auto;padding:12px}
  .top{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap}
  .controls{display:flex;gap:8px;align-items:center}
  .btn{background:var(--green);color:#fff;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:700}
  .btn.secondary{background:transparent;color:var(--red);border:2px solid var(--red)}
  .search{padding:8px;border-radius:8px;border:1px solid #ddd}
  .filters{display:flex;gap:8px;align-items:center}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px;margin-top:12px}
  .card{background:#f7fff7;border-radius:12px;padding:10px;box-shadow:0 2px 6px rgba(0,0,0,.06);display:flex;flex-direction:column}
  .thumb{height:160px;border-radius:8px;overflow:hidden;margin-bottom:8px;background:#e0e0e0;display:flex;align-items:center;justify-content:center}
  .thumb img{width:100%;height:100%;object-fit:cover}
  .title{font-weight:800;font-size:16px;margin-bottom:6px}
  .desc{color:var(--muted);font-size:13px;min-height:40px}
  .meta{display:flex;gap:8px;align-items:center;margin-top:8px;justify-content:space-between}
  .download{background:var(--red);color:#fff;padding:8px 10px;border-radius:8px;text-decoration:none;font-weight:700}
  .delete{background:#c62828;color:#fff;padding:6px 10px;border-radius:8px;border:none;cursor:pointer}
  .form{margin-top:16px;background:#f2f2f2;padding:12px;border-radius:10px}
  .form input[type="text"], .form textarea, .form select{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:1px solid #ddd;box-sizing:border-box}
  .small{font-size:13px;color:var(--muted)}
  footer{margin-top:20px;padding:18px;text-align:center;color:#444}
  a.tg{color:var(--red);font-weight:800;text-decoration:none}
  @media(max-width:560px){.top{flex-direction:column;align-items:stretch}.controls{justify-content:space-between}}
</style>
</head>
<body>
  <header>Infinity_Craft - Ù…ÙˆØ¯Ø§Øª Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</header>

  <div class="container">
    <div class="top">
      <div class="controls">
        <input id="search" class="search" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¯ Ø£Ùˆ Ø§Ù„ÙˆØµÙ..." />
        <div class="filters">
          <select id="categoryFilter" style="padding:8px;border-radius:8px;border:1px solid #ddd">
            <option value="">ÙƒÙ„ Ø§Ù„ÙØ¦Ø§Øª</option>
            <option value="Ø£Ø³Ù„Ø­Ø©">Ø£Ø³Ù„Ø­Ø©</option>
            <option value="Ø£Ø¯ÙˆØ§Øª">Ø£Ø¯ÙˆØ§Øª</option>
            <option value="Ø¥Ø¶Ø§ÙØ§Øª">Ø¥Ø¶Ø§ÙØ§Øª</option>
          </select>
        </div>
      </div>

      <div>
        <button id="openFormBtn" class="btn">ğŸ“¤ Ø§Ù†Ø´Ø± Ù…ÙˆØ¯Ùƒ</button>
        <button id="refreshBtn" class="btn secondary">ØªØ­Ø¯ÙŠØ«</button>
      </div>
    </div>

    <!-- ÙÙˆØ±Ù… Ø§Ù„Ø¥Ø¶Ø§ÙØ© -->
    <div id="formWrap" class="form" style="display:none">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <strong>Ù†Ø´Ø± Ù…ÙˆØ¯ Ø¬Ø¯ÙŠØ¯</strong>
        <button id="closeForm" class="btn secondary" style="padding:6px 8px">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>

      <div style="margin-top:8px" class="small">Ø§Ø³Ù…Ùƒ (Ø³ÙŠØ¸Ù‡Ø± ÙƒÙ…Ø§Ù„Ùƒ Ù„Ù„Ù…ÙˆØ¯)</div>
      <input id="ownerName" type="text" placeholder="Ø§Ø³Ù…Ùƒ" />

      <div class="small">Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¯</div>
      <input id="name" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¯" />

      <div class="small">ÙˆØµÙ Ù‚ØµÙŠØ±</div>
      <textarea id="desc" rows="3" placeholder="ÙˆØµÙ Ø§Ù„Ù…ÙˆØ¯"></textarea>

      <div class="small">Ø§Ù„ÙØ¦Ø©</div>
      <select id="category">
        <option value="Ø¥Ø¶Ø§ÙØ§Øª">Ø¥Ø¶Ø§ÙØ§Øª</option>
        <option value="Ø£Ø³Ù„Ø­Ø©">Ø£Ø³Ù„Ø­Ø©</option>
        <option value="Ø£Ø¯ÙˆØ§Øª">Ø£Ø¯ÙˆØ§Øª</option>
      </select>

      <div class="small" style="margin-top:6px">ØµÙˆØ±Ø© Ø§Ù„Ù…ÙˆØ¯ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ â€” Ø±ÙØ¹ Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ)</div>
      <input id="imageFile" type="file" accept="image/*" />

      <div class="small">Ø£Ùˆ Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© (Ù…Ø«Ù„Ø§Ù‹ Ù…Ù† imgbb)</div>
      <input id="imageUrl" type="text" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" />

      <div class="small">Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ­Ù…ÙŠÙ„ (Ù…Ù‡Ù…)</div>
      <input id="downloadLink" type="text" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ­Ù…ÙŠÙ„ (Ù…Ø«Ø§Ù„: mediafire link)" />

      <div class="small">ÙƒÙ„Ù…Ø© Ø³Ø± Ù„Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¯ Ù„Ø§Ø­Ù‚Ø§Ù‹ (Ø§ÙƒØªØ¨ Ø­Ø§Ø¬Ø© ØªØ­ÙØ¸Ù‡Ø§)</div>
      <input id="deletePass" type="text" placeholder="ÙƒÙ„Ù…Ø© Ø³Ø± Ø­Ø°Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„ÙƒÙ† Ù„Ùˆ Ø­Ø·ÙŠØªÙ‡Ø§ ØªØ¶Ù…Ù† Ù…Ù„ÙƒÙŠØªÙƒ)" />

      <div style="margin-top:10px;display:flex;gap:8px">
        <button id="publishBtn" class="btn">Ù†Ø´Ø± Ø§Ù„Ù…ÙˆØ¯</button>
        <button id="clearBtn" class="btn secondary">Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„</button>
      </div>
      <div id="formMsg" class="small" style="margin-top:8px;color:var(--muted)"></div>
    </div>

    <div id="modsGrid" class="grid" aria-live="polite"></div>

    <div id="empty" style="text-align:center;color:var(--muted);margin-top:18px;display:none">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ¯Ø§Øª Ø­Ø§Ù„ÙŠØ§</div>

    <footer>
      Ø±Ø§Ø¨Ø· Ù‚Ù†Ø§Ø© Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…:
      <a class="tg" href="https://t.me/+qq_iB3QRLpJjMGFk" target="_blank">https://t.me/+qq_iB3QRLpJjMGFk</a>
    </footer>
  </div>

<script>
/*
  Ù‡Ø°Ø§ Ø§Ù„Ø³ÙƒØ±Ø¨Øª ÙŠØ¶Ù…Ù†:
  - Ù†Ø´Ø± Ø§Ù„Ù…ÙˆØ¯ ÙŠØ¹Ù…Ù„ ÙÙˆØ±ÙŠØ§Ù‹ ÙˆÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
  - Ø§Ù„Ø¨Ø­Ø« Ùˆ Ø§Ù„ÙÙ„Ø§ØªØ± ØªØ¹Ù…Ù„
  - Ø§Ù„Ø­Ø°Ù Ù…Ø­Ù…ÙŠ Ø¨ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ø¯Ø®Ù„Ù‡Ø§ ØµØ§Ø­Ø¨ Ø§Ù„Ù…ÙˆØ¯ ÙˆÙ‚Øª Ø§Ù„Ù†Ø´Ø±
  - Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ ÙÙŠ localStorage Ø¨Ø­ÙŠØ« ØªØ´ØªØºÙ„ Ø§Ù„ØµÙØ­Ø© Ø¨Ø¯ÙˆÙ† Firebase
  - Ø®ÙŠØ§Ø± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) Ù„Ø±Ø¨Ø· Firebase Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Ù‹ Ù„Ùˆ ØªØ±ÙŠØ¯ Ù„Ø§Ø­Ù‚Ø§Ù‹
*/

// ---------- Local fallback storage ----------
const LOCAL_KEY = 'ic_mods_v2';

// load from localStorage
function loadLocalMods(){
  const j = localStorage.getItem(LOCAL_KEY);
  if(!j) return [];
  try { return JSON.parse(j); } catch(e){ return []; }
}
function saveLocalMods(arr){
  localStorage.setItem(LOCAL_KEY, JSON.stringify(arr));
}

// ---------- in-memory mods array (source of truth for UI) ----------
let mods = loadLocalMods(); // [{id, name, description, imageUrl, downloadLink, category, ownerName, deletePass, createdAt}]

// helper id
function uid(){ return 'm_'+Math.random().toString(36).slice(2,9); }

// render
const modsGrid = document.getElementById('modsGrid');
const empty = document.getElementById('empty');
function renderMods(){
  const q = document.getElementById('search').value.trim().toLowerCase();
  const cat = document.getElementById('categoryFilter').value;
  modsGrid.innerHTML = '';
  const filtered = mods.filter(m=>{
    if(cat && m.category !== cat) return false;
    if(!q) return true;
    return (m.name && m.name.toLowerCase().includes(q)) || (m.description && m.description.toLowerCase().includes(q));
  });
  if(filtered.length === 0) empty.style.display = 'block'; else empty.style.display = 'none';
  filtered.forEach(mod => {
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <div class="thumb">${mod.imageUrl ? `<img src="${escapeHtml(mod.imageUrl)}" alt="">` : '<div style="padding:10px;color:#555">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØµÙˆØ±Ø©</div>'}</div>
      <div class="title">${escapeHtml(mod.name)}</div>
      <div class="desc">${escapeHtml(mod.description || '')}</div>
      <div class="meta">
        <a class="download" href="${escapeHtml(mod.downloadLink)}" target="_blank">ğŸ”— ØªØ­Ù…ÙŠÙ„</a>
        <div style="font-size:12px;color:var(--muted)">ÙØ¦Ø©: ${escapeHtml(mod.category || 'â€”')}</div>
      </div>
      <div style="margin-top:8px;display:flex;justify-content:space-between;align-items:center">
        <div class="small">Ø¨ÙˆØ§Ø³Ø·Ø©: ${escapeHtml(mod.ownerName || 'Ù…Ø¬Ù‡ÙˆÙ„')}</div>
        <div id="actions-${mod.id}"></div>
      </div>
    `;
    modsGrid.appendChild(card);

    const actionsDiv = document.getElementById(`actions-${mod.id}`);
    // Ø²Ø± Ø­Ø°Ù ÙŠØ¸Ù‡Ø± Ù„ÙƒÙ„ ÙˆØ§Ø­Ø¯ Ù„ÙƒÙ† ÙŠØ·Ù„Ø¨ Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø§Ù„ØµØ­ÙŠØ­
    const delBtn = document.createElement('button');
    delBtn.className = 'delete';
    delBtn.textContent = 'ğŸ—‘ Ø­Ø°Ù';
    delBtn.onclick = ()=> {
      const entered = prompt('Ø§ÙƒØªØ¨ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¯ (Ø§Ù„ØªÙŠ ÙˆØ¶Ø¹Ù‡Ø§ ØµØ§Ø­Ø¨ Ø§Ù„Ù…ÙˆØ¯):');
      if(entered === null) return;
      if(mod.deletePass && mod.deletePass === entered){
        // Ø­Ø°Ù Ù…Ø­Ù„ÙŠ
        mods = mods.filter(x=>x.id !== mod.id);
        saveLocalMods(mods);
        renderMods();
        alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¯');
        // (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) Ù„Ùˆ Ù…Ø±Ø¨Ø· Firebase Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ù…Ù† Ø§Ù„DB Ø£ÙŠØ¶Ø§Ù‹
      } else {
        alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø© Ø£Ùˆ Ø§Ù„Ù…ÙˆØ¯ Ù„ÙŠØ³ Ù„Ù‡ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±.');
      }
    };
    actionsDiv.appendChild(delBtn);
  });
}

// escape
function escapeHtml(s){ if(!s) return ''; return s.replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

// ---------- Form logic ----------
const openFormBtn = document.getElementById('openFormBtn');
const formWrap = document.getElementById('formWrap');
const closeForm = document.getElementById('closeForm');
const publishBtn = document.getElementById('publishBtn');
const clearBtn = document.getElementById('clearBtn');
const formMsg = document.getElementById('formMsg');
const imageFileInput = document.getElementById('imageFile');

openFormBtn.addEventListener('click', ()=> {
  formWrap.style.display = 'block';
  const saved = localStorage.getItem('ic_ownerName') || '';
  document.getElementById('ownerName').value = saved;
  window.scrollTo({top:0,behavior:'smooth'});
});
closeForm.addEventListener('click', ()=> formWrap.style.display = 'none');
clearBtn.addEventListener('click', ()=>{
  document.getElementById('name').value='';
  document.getElementById('desc').value='';
  document.getElementById('imageUrl').value='';
  document.getElementById('downloadLink').value='';
  document.getElementById('deletePass').value='';
  imageFileInput.value = '';
  formMsg.textContent = '';
});

// helper: read file as DataURL
function readFileAsDataURL(file){
  return new Promise((res,rej)=>{
    const fr = new FileReader();
    fr.onload = ()=> res(fr.result);
    fr.onerror = ()=> rej('file error');
    fr.readAsDataURL(file);
  });
}

publishBtn.addEventListener('click', async ()=> {
  const ownerName = document.getElementById('ownerName').value.trim();
  const name = document.getElementById('name').value.trim();
  const desc = document.getElementById('desc').value.trim();
  const category = document.getElementById('category').value;
  const imageUrlField = document.getElementById('imageUrl').value.trim();
  const downloadLink = document.getElementById('downloadLink').value.trim();
  const deletePass = document.getElementById('deletePass').value.trim();
  const file = imageFileInput.files[0];

  if(!ownerName){ formMsg.textContent = 'Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ø¹Ø´Ø§Ù† Ù†Ø³Ø¬Ù„ ØµØ§Ø­Ø¨ Ø§Ù„Ù…ÙˆØ¯'; return; }
  if(!name || !desc || !downloadLink){ formMsg.textContent = 'Ø§Ù…Ù„Ø£ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„ÙˆØµÙ ÙˆØ±Ø§Ø¨Ø· Ø§Ù„ØªØ­Ù…ÙŠÙ„'; return; }

  formMsg.textContent = 'â³ Ø¬Ø§Ø±Ù Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¯...';
  localStorage.setItem('ic_ownerName', ownerName);

  try{
    let finalImage = '';
    if(file){
      // read local file as data url (works offline; image stored in localStorage)
      finalImage = await readFileAsDataURL(file);
    } else if(imageUrlField){
      finalImage = imageUrlField;
    } else {
      finalImage = '';
    }

    const newMod = {
      id: uid(),
      name,
      description: desc,
      imageUrl: finalImage,
      downloadLink,
      category,
      ownerName,
      deletePass: deletePass || null,
      createdAt: Date.now()
    };

    // add local
    mods.unshift(newMod); // newest first
    saveLocalMods(mods);
    renderMods();
    formMsg.textContent = 'âœ… ØªÙ… Ø§Ù„Ù†Ø´Ø± Ù…Ø­Ù„ÙŠØ§Ù‹!';

    // clear fields (but keep ownerName)
    document.getElementById('name').value='';
    document.getElementById('desc').value='';
    document.getElementById('imageUrl').value='';
    document.getElementById('downloadLink').value='';
    document.getElementById('deletePass').value='';
    imageFileInput.value = '';

    // Optional: try to push to Firebase if configured (see Firebase section below)
    try { if(window._tryFirebasePublish) await window._tryFirebasePublish(newMod); } catch(e){ console.warn('Firebase publish failed', e); }

  } catch(err){
    console.error(err);
    formMsg.textContent = 'âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù†Ø´Ø±';
  }
});

// search & filter listeners
document.getElementById('search').addEventListener('input', ()=> renderMods());
document.getElementById('categoryFilter').addEventListener('change', ()=> renderMods());
document.getElementById('refreshBtn').addEventListener('click', ()=> renderMods());

// initial render
renderMods();

/* ================= optional Firebase integration =================
 If later you want real-time shared between all users, replace
 the firebaseConfig below with your project config and uncomment
 the code. The local fallback still works if Firebase not set.

 Steps:
  - Create Firebase project
  - Enable Firestore or Realtime DB & Storage if needed
  - Replace firebaseConfig.apiKey !== 'YOUR_API_KEY' to real value
  - The script below will attempt to push newMod to Firestore and listen for remote changes
  - For simplicity here we provide a basic Firestore example
=================================================================*/

(async function tryInitFirebase(){
  // put your firebase config here if you want remote sync; leave as default to use local-only.
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY", // <-- Ù„Ùˆ Ù…Ø´ Ø¨Ø¯Ù‘Ù„ØªÙ‡Ø§ ÙŠØ¨Ù‚Ù‰ local-only
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "SENDER_ID",
    appId: "APP_ID"
  };

  if(!firebaseConfig.apiKey || firebaseConfig.apiKey === 'YOUR_API_KEY') {
    // not configured -> skip firebase init
    return;
  }

  try{
    // load firebase modules dynamically
    const [{ initializeApp }, { getFirestore, collection, addDoc, onSnapshot, query, orderBy, doc, deleteDoc }, { getStorage, ref: sRef, uploadBytes, getDownloadURL }] =
      await Promise.all([
        import('https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js'),
        import('https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js'),
        import('https://www.gstatic.com/firebasejs/10.14.0/firebase-storage.js')
      ]);

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const modsCol = collection(db, 'mods');
    const q = query(modsCol, orderBy('createdAt', 'desc'));

    // listen remote -> replace local list with remote OR merge (we'll merge to avoid overwriting local-only)
    onSnapshot(q, snapshot => {
      const remote = [];
      snapshot.forEach(d => {
        const dt = d.data();
        remote.push({
          id: d.id,
          name: dt.name,
          description: dt.description,
          imageUrl: dt.imageUrl,
          downloadLink: dt.downloadLink,
          category: dt.category,
          ownerName: dt.ownerName,
          deletePass: dt.deletePass || null,
          createdAt: dt.createdAt ? dt.createdAt.toMillis ? dt.createdAt.toMillis() : (dt.createdAt) : Date.now()
        });
      });
      // merge remote and local (remote first, avoid duplicates by id)
      const map = {};
      remote.forEach(r => map[r.id] = r);
      mods.forEach(l => { if(!map[l.id]) map[l.id] = l; }); // keep local ones not in remote
      mods = Object.values(map).sort((a,b)=>b.createdAt - a.createdAt);
      saveLocalMods(mods);
      renderMods();
    });

    // function to publish to firestore (uploads image if DataURL)
    window._tryFirebasePublish = async function(newMod){
      // if image is dataURL, upload to storage first
      let imageToUse = newMod.imageUrl;
      if(newMod.imageUrl && newMod.imageUrl.startsWith('data:')){
        // upload
        const storage = getStorage(app);
        const blob = dataURLtoBlob(newMod.imageUrl);
        const filename = 'mods_images/'+Date.now()+'.png';
        const sref = sRef(storage, filename);
        await uploadBytes(sref, blob);
        imageToUse = await getDownloadURL(sref);
      }
      // add doc
      await addDoc(modsCol, {
        name: newMod.name,
        description: newMod.description,
        imageUrl: imageToUse || '',
        downloadLink: newMod.downloadLink,
        category: newMod.category,
        ownerName: newMod.ownerName,
        deletePass: newMod.deletePass || null,
        createdAt: Date.now()
      });
    };

    // helper convert dataURL to blob
    function dataURLtoBlob(dataurl) {
      const arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1];
      const bstr = atob(arr[1]); let n = bstr.length; const u8arr = new Uint8Array(n);
      while(n--) u8arr[n] = bstr.charCodeAt(n);
      return new Blob([u8arr], {type:mime});
    }

  }catch(e){
    console.warn('Firebase init failed', e);
  }
})();

</script>
</body>
</html>
