<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Infinity Craft - Ù…ÙˆØ¯Ø§Øª Ù…Ø§ÙŠÙ†ÙƒØ±Ø§ÙØª</title>
<style>
  body { font-family:'Cairo',sans-serif; background:#fff; color:#222; text-align:center; margin:0; padding:0; }
  header { background:#d62828; color:white; padding:15px; font-size:22px; }
  .mods { display:grid; grid-template-columns:repeat(auto-fit, minmax(250px, 1fr)); gap:10px; padding:10px; }
  .mod { border:2px solid #4CAF50; border-radius:10px; padding:10px; background:#f9f9f9; transition:0.3s; }
  .mod:hover { transform:scale(1.03); }
  .mod img { width:100%; border-radius:10px; }
  button { background:#4CAF50; color:white; border:none; padding:10px 15px; border-radius:8px; cursor:pointer; margin:5px; }
  button:hover { background:#45a049; }
  #uploadForm { display:none; background:#f2f2f2; padding:15px; border-radius:10px; margin:10px; }
  input, textarea { width:90%; margin:5px; padding:8px; border-radius:6px; border:1px solid #ccc; }
  a { color:#d62828; text-decoration:none; margin:10px; display:inline-block; }
  #searchBox { width:80%; padding:8px; margin:10px auto; border:2px solid #4CAF50; border-radius:8px; font-size:16px; }
</style>
</head>
<body>

<header>Infinity Craft ğŸŒ</header>

<!-- Ø£Ø²Ø±Ø§Ø± -->
<button onclick="toggleUpload()">ğŸ“¤ Ø§Ù†Ø´Ø± Ù…ÙˆØ¯Ùƒ</button>
<a href="https://t.me/+qq_iB3QRLpJjMGFk" target="_blank">ğŸ“¢ Ù‚Ù†Ø§Ø© Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…</a>
<button id="loginBtn">ğŸ”‘ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</button>
<span id="userName"></span>

<!-- Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¨Ø­Ø« -->
<input type="text" id="searchBox" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ÙˆØ¯..." oninput="searchMods()">

<!-- Ù†Ù…ÙˆØ°Ø¬ Ù†Ø´Ø± Ø§Ù„Ù…ÙˆØ¯ -->
<div id="uploadForm">
  <h3>Ù†Ø´Ø± Ù…ÙˆØ¯ Ø¬Ø¯ÙŠØ¯</h3>
  <input id="modName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¯"><br>
  <input id="modDesc" placeholder="ÙˆØµÙ Ø§Ù„Ù…ÙˆØ¯"><br>
  <input id="modImg" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ù…ÙˆØ¯"><br>
  <input id="modLink" placeholder="Ø±Ø§Ø¨Ø· ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¯ (MediaFire Ù…Ø«Ù„Ø§Ù‹)"><br>
  <button onclick="uploadMod()">âœ… Ù†Ø´Ø±</button>
</div>

<h2>ğŸ§© ÙƒÙ„ Ø§Ù„Ù…ÙˆØ¯Ø§Øª</h2>
<div class="mods" id="modsContainer"></div>

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
  import { getDatabase, ref, push, set, onValue, remove } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-analytics.js";
  import { getAuth, GoogleAuthProvider, signInWithRedirect, getRedirectResult, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAtn8wwDmlWe95RA13kAQiY0XDkhnuKoQ0",
    authDomain: "infinity-craft-301e4.firebaseapp.com",
    databaseURL: "https://infinity-craft-301e4-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "infinity-craft-301e4",
    storageBucket: "infinity-craft-301e4.firebasestorage.app",
    messagingSenderId: "979672021905",
    appId: "1:979672021905:web:849ecc0ed6379edb2eb830",
    measurementId: "G-G188MXB3JY"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const analytics = getAnalytics(app);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();

  const modsContainer = document.getElementById('modsContainer');
  const uploadForm = document.getElementById('uploadForm');
  const searchBox = document.getElementById('searchBox');
  const loginBtn = document.getElementById('loginBtn');
  const userName = document.getElementById('userName');

  // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ù† Ø·Ø±ÙŠÙ‚ Google (redirect Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„)
  loginBtn.addEventListener('click', () => {
    signInWithRedirect(auth, provider);
  });

  // Ø¨Ø¹Ø¯ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
  getRedirectResult(auth)
    .then(result => {
      if (result && result.user) {
        const user = result.user;
        userName.textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${user.displayName}`;
        loginBtn.style.display = 'none';
      }
    })
    .catch(error => console.log(error));

  // Ù„Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¯Ø§Ø®Ù„ Ø¨Ø§Ù„ÙØ¹Ù„
  onAuthStateChanged(auth, user => {
    if (user) {
      userName.textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${user.displayName}`;
      loginBtn.style.display = 'none';
    }
  });

  // Ø¹Ø±Ø¶ Ø£Ùˆ Ø¥Ø®ÙØ§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù†Ø´Ø±
  window.toggleUpload = function() {
    uploadForm.style.display = uploadForm.style.display === 'none' ? 'block' : 'none';
  }

  // Ø±ÙØ¹ Ù…ÙˆØ¯ Ø¬Ø¯ÙŠØ¯ ğŸ”¥ Ù…Ø¹ UID ØµØ§Ø­Ø¨ Ø§Ù„Ù…ÙˆØ¯
  window.uploadMod = function() {
    const user = auth.currentUser;
    if (!user) { alert("âš ï¸ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹!"); return; }

    const name = document.getElementById('modName').value.trim();
    const desc = document.getElementById('modDesc').value.trim();
    const img = document.getElementById('modImg').value.trim();
    const link = document.getElementById('modLink').value.trim();

    if (!name || !desc || !img || !link) {
      alert("âš ï¸ Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ù…Ù„Ø£ ÙƒÙ„ Ø§Ù„Ø®Ø§Ù†Ø§Øª!");
      return;
    }

    const modsRef = ref(db, "mods");
    const newMod = push(modsRef);
    set(newMod, { name, desc, img, link, owner: user.uid })
      .then(() => {
        alert("âœ… ØªÙ… Ù†Ø´Ø± Ø§Ù„Ù…ÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­!");
        document.getElementById('modName').value = '';
        document.getElementById('modDesc').value = '';
        document.getElementById('modImg').value = '';
        document.getElementById('modLink').value = '';
        uploadForm.style.display = 'none';
      })
      .catch(() => alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù†Ø´Ø±!"));
  }

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¯Ø§Øª Ù…Ø¹ Ø²Ø±Ø§Ø± Ø­Ø°Ù Ù…Ø¤Ù…Ù† ğŸ—‘ï¸
  function loadMods() {
    const modsRef = ref(db, "mods");
    onValue(modsRef, snapshot => {
      modsContainer.innerHTML = '';
      const data = snapshot.val();
      if (!data) {
        modsContainer.innerHTML = "<p>ğŸš« Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ¯Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</p>";
        return;
      }

      const mods = Object.entries(data).reverse();
      mods.forEach(([id, mod]) => {
        const div = document.createElement('div');
        div.className = 'mod';
        div.innerHTML = `
          <h3>${mod.name}</h3>
          <img src="${mod.img}" alt="${mod.name}">
          <p>${mod.desc}</p>
          <a href="${mod.link}" target="_blank"><button>â¬‡ï¸ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¯</button></a>
          <button class="deleteBtn" data-id="${id}" style="display:none;">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¯</button>
        `;
        modsContainer.appendChild(div);

        // Ø¹Ø±Ø¶ Ø²Ø± Ø§Ù„Ø­Ø°Ù Ù„Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‡Ùˆ ØµØ§Ø­Ø¨ Ø§Ù„Ù…ÙˆØ¯
        onAuthStateChanged(auth, user => {
          if (user && mod.owner === user.uid) {
            div.querySelector('.deleteBtn').style.display = 'inline-block';
          }
        });
      });

      // Ø±Ø¨Ø· Ø§Ù„Ø­Ø°Ù
      document.querySelectorAll('.deleteBtn').forEach(btn => {
        btn.addEventListener('click', e => {
          const modId = e.target.getAttribute('data-id');
          if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¯ØŸ')) {
            remove(ref(db, 'mods/' + modId))
              .then(() => alert('ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­!'))
              .catch(() => alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù.'));
          }
        });
      });
    });
  }

  // Ø§Ù„Ø¨Ø­Ø« ğŸ”
  window.searchMods = function() {
    const term = searchBox.value.toLowerCase();
    const mods = document.querySelectorAll('.mod');
    mods.forEach(mod => {
      const title = mod.querySelector('h3').textContent.toLowerCase();
      mod.style.display = title.includes(term) ? 'block' : 'none';
    });
  }

  loadMods();
</script>

</body>
</html>
